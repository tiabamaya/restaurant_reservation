<h1>My Reservations</h1>
<p>Welcome, <%= current_user.email %>!</p>

<% if flash[:alert] %>
  <p style="color:red;"><%= flash[:alert] %></p>
<% end %>

<p>
  <%= link_to "Book a Reservation", new_reservation_path, class: "btn" %>
</p>

<%= button_to "Log out", destroy_user_session_path, method: :delete %>

<hr>

<% if @reservations.any? %>
  <table class="res-table" border="1" cellpadding="10" style="border-collapse:collapse; width:100%;">
    <thead>
      <tr>
        <th>Date & Time</th>
        <th>Guests</th>
        <th>Status</th>
        <th style="width:220px;">Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @reservations.each do |r| %>
        <tr style="<%= 'opacity:0.7;' if r.cancelled? %>">
          <td>
            <%# Prefer time_slot.starts_at if available %>
            <%= (r.time_slot&.starts_at || r.reserved_at).strftime("%B %d, %Y • %-I:%M %p") %>
          </td>

          <td><%= r.party_size %></td>

          <td>
            <% if r.booked? %>
              <span style="padding:3px 8px; border:1px solid #2e7d32;">Booked</span>
            <% else %>
              <span style="padding:3px 8px; border:1px solid #777;">Cancelled</span>
            <% end %>
          </td>

          <td>
            <%= link_to "View", reservation_path(r) %>

            <% if r.booked? && r.cancellable? %>
              |
              <%= button_to "Cancel",
                    reservation_path(r),
                    method: :delete,
                    data: { confirm: "Cancel this reservation?" },
                    form: { style: "display:inline" } %>
            <% elsif r.booked? %>
              <span style="margin-left:10px; font-size:0.9em; opacity:0.7;">
                (Too late to cancel)
              </span>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% else %>
  <p>No reservations yet. Click “Book a Reservation”.</p>
<% end %>
